{% load filters %}
<ul>
  <li>Commande créée le {{ order.date_created|date }}</li>
  <li>Commande équipe {{ order.team }}</li>
  {% if order.date_delivered %}
    <li>Commande livrée le {{ order.date_delivered|date }}</li>
  {% else %}
    <li>Statut: {{ order.get_status_display }}</li>
  {% endif %}
  
  {% if user|is_secretary and order.status > 1 and not order.number %}
    <li>Budget à imputer:
      <a href="{% url order_budget order.id %}" class="pencil setBudget">
        {{ order.budget }}
      </a>
    </li>
  {% endif %}
</ul>

<table class="list">
  <thead>
    <th>Utilisateur</th>
    <th>Produit</th>
    <th>Conditionnement</th>
    <th>Référence</th>
    <th>N° Offre</th>
    <th>Prix unitaire</th>
    <th>Quantité</th>
    <th>Prix total</th>
    {% if order.status < 2 or user|is_secretary %}
      <th>Action</th>
    {% endif %}
  </thead>
  
  <tbody>
    {% for order_item in order.items.all %}
      <tr class="{% cycle 'odd' 'even' %}">
        <td>{{ order_item.get_fullname }}</td>
        <td>{{ order_item.name }}</td>
        <td>{{ order_item.packaging|default:"" }}</td>
        <td>{{ order_item.reference|default:"" }}</td>
        <td>{{ order_item.offer_nb|default:"" }}</td>
        <td>{{ order_item.price }} €</td>
        <td>
        {% if order.status == 0 or order.status == 1 and user|is_validator %}
          {# <input type="text" id="{{order_item.id}}" name="setQuantity" value="{{ order_item.quantity }}" style="width:15px;" /> #}
          <button id="{{order_item.id}}" class="pencil setQty">{{ order_item.quantity }}</button>
        {% else %}
          {{ order_item.quantity }}
        {% endif %}
        </td>
        <td>{{ order_item.total_price }} €</td>
        {% if order.status < 2 %}
          <td>
            <button id="{{order_item.id}}" href="{% url orderitem_delete order_item.id %}?next={{next}}" class="trash confirmDelCart">
              Retirer du panier
            </button>
          </td>
        {% else %}{% if user|is_secretary %}
          <td>
            <a href="{% url orderitem_detail order_item.id %}" class="pencil">Modifier</a>
            <a href="{% url orderitem_delete order_item.id %}?next={% url order_item order.id %}" class="trash confirmDel">Supprimer</a>
          </td>
        {% endif %}{% endif %}
      </tr>
    {% endfor %}
  </tbody>
</table>

<p><strong>PRIX TOTAL COMMANDE: {{ order.price }} €</strong></p>
{% if not order.number %}
  {% if order.status < 2 and user|is_normal %}
    <div style="float:right">
      <a href="{% url add_debit order.id %}?next={{next}}" class="plus">Frais annexes</a>
      <a href="{% url add_credit order.id %}?next={{next}}" class="minus">Remises</a>
    </div>
  {% else %}{% if order.status < 3 and user|is_validator %}
    <div style="float:right">
      <a href="{% url add_debit order.id %}?next={{next}}" class="plus">Frais annexes</a>
      <a href="{% url add_credit order.id %}?next={{next}}" class="minus">Remises</a>
    </div>
  {% endif %}{% endif %}
{% endif %}

{% if user|is_secretary %}
  <div style="float:right">
    <a href="{% url add_debit order.id %}?next={{next}}" class="plus">Frais annexes</a>
    <a href="{% url add_credit order.id %}?next={{next}}" class="minus">Remises</a>
  </div>
{% endif %}
<br />

{% if user|is_secretary %}
  {% if order.status > 1 %}
    <a href="{% url tab_orders %}" class="check">Valider</a>
  {% endif %}
{% endif %}

<div class="cleaner"></div>

{% if order.status == 0 %}
  {% if user|is_validator %}
    <a href="{% url set_next_status order.id %}" class="cart">Commander</a>
  {% else %}
    <a href="{% url set_next_status order.id %}" class="cart confirm">Commander</a>
  {% endif %}
  <a href="{% url order_delete order.id %}" class="trash confirmDel">Supprimer</a>
{% else %}{% if order.status == 1 and user|is_validator %}
  <a href="{% url set_next_status order.id %}" class="check setBudget">Valider</a>
  <a href="{% url order_delete order.id %}" class="trash confirmDel">Supprimer</a>
{% endif %}{% endif %}

{% include "order/_dialogs.html" %}
