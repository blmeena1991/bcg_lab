{% extends "main_custom.html" %}
{% load paginator filters %}

{% block menu_budgets %}selected{% endblock %}

{% block buttons %}

{% if budget %}
  <div class="btn_wrapper">
    <a href="{% url debit_budget budget.id %}" class="btn_small">
      <img src="{{ MEDIA_URL }}img/icons/delete.png" />Débiter
    </a>
  </div>
  <div class="btn_wrapper">
    <a href="{% url credit_budget budget.id %}" class="btn_small">
      <img src="{{ MEDIA_URL }}img/icons/add.png" />Créditer
    </a>
  </div>
  <div class="btn_wrapper">
    <a href="{% url budgetlines %}" class="btn_big">
      <img src="{{ MEDIA_URL }}img/icons/magnifier.png" />Détail de tous les budgets
    </a>
  </div>
{% endif %}
<div class="btn_wrapper">
  <a href="{% url budgets %}" class="btn_big">
    <img src="{{ MEDIA_URL }}img/icons/coins.png" />Retour liste des budgets
  </a>
</div>
{% endblock %}

{% block content %}

{% regroup budget_lines.object_list by team as team_list %}

{% for team in team_list %}
  <div id="content" style="min-height:0">
  <div id="content_header"><h2>Equipe {{ team.grouper }}</h2></div>
  
  {% regroup team.list by name as budget_list %}
  
  <table class="list">
    <thead>
      <th widht="50px">budget</th>
      <th width="80px">n° de cmde</th>
      <th width="100px">date de l'acte</th>
      <th width="50px">nature</th>
      <th width="50px">tutelle</th>
      <th width="50px">type de crédit</th>
      <th width="100px">fournisseur</th>
      <th width="80px">offre</th>
      <th>désignation</th>
      <th width="50px">ref</th>
      <th width="90px">crédit</th>
      <th width="90px">débit</th>
      <th width="50px">qté</th>
      <th width="80px">Montant total</th>
      <th width="80px">Montant dispo</th>
    </thead>
      
    <tbody>
      {% for budget in budget_list %}
        {% if forloop.counter > 1 %}
          <tr class="empty_row">
            <td colspan="15"></td>
          </tr>
        {% endif %}
        
        {% for budget_line in budget.list %}
        <tr class="{% cycle 'even' 'odd' %}">
          {% if forloop.counter == 1 %}
            <td><strong>{{ budget.grouper }}</strong></td>
          {% else %}
            <td>{{ budget.grouper }}</td>
          {% endif %}
          <td>{{ budget_line.number|default:"" }}</td>
          <td>{{ budget_line.date|date }}</td>
          <td>{{ budget_line.nature }}</td>
          <td>{{ budget_line.get_budget_type_display|default:"" }}</td>
          <td>{{ budget_line.credit_type|default:"" }}</td>
          <td>{{ budget_line.provider|default:"" }}</td>
          <td>{{ budget_line.offer|default:"" }}</td>
          <td>{{ budget_line.product|default:"" }}</td>
          <td>{{ budget_line.ref|default:"" }}</td>
          <td style="color:green">{{ budget_line.credit|default:"" }}</td>
          <td style="color:red">{{ budget_line.debit|default:"" }}</td>
          <td>{{ budget_line.quantity|default:1 }}</td>
          <td>{{ budget_line.product_price|default:"" }}</td>
          <td>{{ budget_line.get_amount_left }}</td>
        </tr>
        {% endfor %}
      {% endfor %}
    </tbody>
  </table>
  </div>
{% endfor %}
{% pagination budget_lines %}

{% endblock %}
