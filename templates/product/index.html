{# PAGE PRODUITS #}

{% extends "main_custom.html" %}
{% load paginator filters %}

{% block menu_product %}selected{% endblock %}

{% block content %}

{% if products %}

{# START: Filter box #}
<div id="content" style="float:left;min-height:0;margin-right:10px">
  <h2>Chercher par fournisseur</h2>
  <form action="{% url product_index %}" method="get">
    <table>
      <tr>
        <td>{{ filter_form.provider }}</td>
        <td><button type="submit" class="all">Chercher</button></td>
        <td><a href="{% url product_index %}" class="refresh">Liste globale</a></td>
      </tr>
    </table>
  </form>
</div>
<div id="content" style="float:left;min-height:0">
  <h2>Chercher par produit</h2>
  <form action="{% url product_index %}" method="get">
    <table>
      <tr>
        <td>{{ filter_form.product }}</td>
        <td><button type="submit" class="all">Chercher</button></td>
        <td><a href="{% url product_index %}" class="refresh">Liste globale</a></td>
      </tr>
    </table>
  </form>
</div>
{# END: Filter box #}

<div class="cleaner"></div>

{# START: Product list #}
<div id="content" style="min-height:0">
  <div id="content_header">
    <h2>Liste des produits - Page {{ products.number }} sur {{ products.paginator.num_pages }}.</h2>
  </div>
  
  {% pagination products %}
  <table class="list">
    <thead>
        <th>Fournisseur</th>
        <th {% if user|is_admin %}width="210px"{% endif %}>Nom du produit</th>
        <th>Cond.</th>
        <th>Réf.</th>
        <th>Prix</th>
        <th>N° Offre</th>
        <th>Expiration</th>
        <th>Nomen.</th>
        <th>MAJ</th>
        <th>Action</th>
    </thead>
    
    <tbody>
      {% for product in products.object_list %}
        <tr class="{% cycle 'even' 'odd' %} {% if product.has_expired %}expired{% else %}{% if product.soon_expired %}soon_expired{% endif %}{% endif %}">
          <td>{{ product.provider.name }}</td>
          <td>{{ product.name }}</td>
          <td>{{ product.packaging }}</td>
          <td>{{ product.reference }}</td>
          <td>{{ product.price }}&nbsp;€</td>
          <td>{{ product.offer_nb }}</td>
          <td>{{ product.expiry|date }}</td>
          <td>{{ product.nomenclature }}</td>
          <td>{{ product.last_change|date }}</td>
          <td>
            <button id="{{product.id}}" class="plus addToCart noloading">
              Panier
            </button>
            {% if product|is_in_charge:user or user|is_admin %}
              <a href="{% url product_item product.id %}" class="pencil">Editer</a>
            {% endif %}
          </td>
        </tr>
      {% endfor %}
    </tbody>
    
    <tfoot>
      <tr><td colspan="9">{% pagination products %}</td></tr>
    </tfoot>
  </table>
</div>
{# END: Product list #}

{% endif %}


<div id="addToCart" class="dialog" title="Saisissez la quantité à commander">
  <form action="{% url cart_add %}" method="POST" style="padding:0">{% csrf_token %}
    <input type="hidden" name="url_params" value="{{url_params}}" />
    <input type="hidden" name="product_id" value="" />
    <div class="form-row">
      <div id="qty-error-msg"></div>
      <label for="quantity">Quantité</label>
      <div class="cleaner"></div>
      <input type="text" name="quantity" value="" />
      <div class="cleaner"></div>
    </div>
  </form>
</div>

{% endblock %}
