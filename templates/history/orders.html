{% extends "base_history.html" %}
{% load paginator filters %}

{% block history_orders %}active{% endblock %}

{% block header %}
  <h1>Historique commandes</h1>
{% endblock %}

{% block content %}
<!-- Start: search form -->
<div class="bar">
    <a href="#" class="expand">Dérouler</a>
    <a href="#" class="hide">Cacher</a>
    <h4>Recherche de commandes réceptionnées</h4>
</div>
<div class="bar_content">
  <form action="{% url history %}" method="POST">{% csrf_token %}
    <strong>Chercher les commandes qui correspondent à {{ filter_form.connector }} conditions suivantes:</strong>
    <div class="cleaner"></div>
    <table>
      <tr>
        <td>Equipe:</td>
        <td>{{ filter_form.team }}</td>
        <td width="10%"></td>
        <td>Date de réception (min/max):</td>
        <td>{{ filter_form.date_created__gte }}</td>
        <td>{{ filter_form.date_created__lte }}</td>
      </tr>
      <tr>
        <td>Fournisseur:</td>
        <td>{{ filter_form.provider }}</td>
        <td width="5%"></td>
        <td>Fournisseur d'origine:</td>
        <td>{{ filter_form.origin }}</td>
      </tr>
      <tr>
        <td>Produit:</td>
        <td>{{ filter_form.name }}</td>
        <td width="5%"></td>
        <td>Référence:</td>
        <td>{{ filter_form.reference }}</td>
      </tr>
    </table>
    <div class="cleaner"></div>
    <button type="submit" class="all">Chercher</button>
    <a href="{% url history %}" class="refresh">Liste globale</a>
  </form>
</div>
<div class="cleaner"></div>
<br />
<!-- End: search form -->

{% if history.object_list %}
  <h2>Liste des commandes réceptionnées - Page {{ history.number }} sur {{ history.paginator.num_pages }}.</h2>
  {% pagination history %}
  <table class="list">
    <thead>
      <th>Date</th>
      <th>Equipe</th>
      <th>Fournisseur</th>
      <th>Prix</th>
      {% if user|is_validator or user|is_super_validator or user|is_secretary or user|is_super_secretary %}
        <th>Budget</th>
      {% endif %}
      <th>Action</th>
    </thead>

    <tbody>
      {% for item in history.object_list %}
        <tr class="{% cycle 'even' 'odd' %}">
          <td>{{ item.date_delivered|date }}</td>
          <td>{{ item.team }}</td>
          <td>{{ item.provider }}</td>
          <td>{{ item.price }}</td>
          {% if user|is_validator or user|is_super_validator or user|is_secretary or user|is_super_secretary %}
            <td>{{ item.budget }}</td>
          {% endif %}
          <td>
            <a href="{{ item.get_absolute_url }}" class="zoomin">
              Voir détail
            </a>
          </td>
        </tr>
      {% endfor %}
    </tbody>
  </table>

  {% pagination history %}
{% else %}
  <h2>Liste des commandes réceptionnées</h2>
  <p>Aucun résultat.</p>
{% endif %}
{% endblock %}
